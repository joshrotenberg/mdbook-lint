#!/bin/sh
#
# Light pre-commit hook for mdbook-lint (faster for development)
# This runs only the most essential checks
#

set -e

echo "ğŸ” Running light pre-commit checks..."

# 1. Format check
echo "ğŸ“ Checking code formatting..."
if ! cargo fmt --all -- --check; then
    echo "âŒ Code formatting check failed. Please run 'cargo fmt --all' to fix."
    exit 1
fi

# 2. Clippy check  
echo "ğŸ”§ Running clippy..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo "âŒ Clippy found issues. Please fix them before committing."
    exit 1
fi

# 3. Unit tests only (skip integration and doc tests for speed)
echo "ğŸ§ª Running unit tests..."
if ! cargo test --lib --all-features; then
    echo "âŒ Unit tests failed. Please fix them before committing."
    exit 1
fi

# Check for Claude Code signatures
if git diff --cached --name-only | xargs grep -l "Generated with Claude Code" 2>/dev/null; then
    echo "âŒ Found 'Generated with Claude Code' signature in staged files. Please remove it."
    exit 1
fi

echo "âœ… Light pre-commit checks passed!"
echo "ğŸ’¡ Run full checks before pushing: cargo test --test '*' --all-features && cargo test --doc"