# Configuration for release-plz
# Keep it simple - let release-plz do its job

[workspace]
# Don't update all dependencies automatically
dependencies_update = false

# Publishing to crates.io
publish = true

# Increased timeout for publishing multiple crates
publish_timeout = "15m"

# Only create a single tag/release for the workspace after all crates are published
git_release_enable = true
git_tag_enable = true
git_tag_name = "v{{ version }}"

# Safer for workspace projects - don't always release
release_always = false

# Explicit changelog setting (we don't use CHANGELOG.md)
changelog_update = false

# Changelog generation using git-cliff style configuration
[changelog]
# Body template for changelog entries
body = """
{% for group, commits in commits | group_by(attribute="group") %}
### {{ group | upper_first }}
{% for commit in commits %}
- {{ commit.message | upper_first | trim }}\
{% endfor %}
{% endfor %}
"""
# Remove leading/trailing whitespace
trim = true
# Commit message parsers (conventional commits)
commit_parsers = [
    { message = "^feat", group = "Features" },
    { message = "^fix", group = "Bug Fixes" },
    { message = "^doc", group = "Documentation" },
    { message = "^docs", group = "Documentation" },
    { message = "^perf", group = "Performance" },
    { message = "^refactor", group = "Refactor" },
    { message = "^style", group = "Styling" },
    { message = "^test", group = "Testing" },
    { message = "^chore\\(release\\)", skip = true },
    { message = "^chore", group = "Miscellaneous" },
]
# Sort commits oldest to newest
sort_commits = "oldest"
# Protect breaking changes from being filtered
protect_breaking_commits = true

# Main CLI package creates the GitHub release and tag
[[package]]
name = "mdbook-lint"
git_release_enable = true
git_tag_enable = true

# Library packages don't create releases/tags (only published to crates.io)
[[package]]
name = "mdbook-lint-core"
git_release_enable = false
git_tag_enable = false

[[package]]
name = "mdbook-lint-rulesets"
git_release_enable = false
git_tag_enable = false
